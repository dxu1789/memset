<!DOCTYPE html>
<html>
<head>
    <title>SET Multiplayer</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #board { display: grid; grid-template-columns: repeat(9, 80px); gap: 10px; margin-top: 20px; }
        .card { width: 80px; height: 110px; background: #2c3e50; border-radius: 5px; cursor: pointer; perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flipped .card-inner { transform: rotateY(180deg); }
        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 5px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .front { background: #eee; transform: rotateY(180deg); }
        .matched { visibility: hidden; }
        /* Symbols */
        .symbol { width: 40px; height: 20px; margin: 3px; border: 2px solid; }
        .oval { border-radius: 10px; }
        .diamond { transform: rotate(45deg); width: 22px; height: 22px; margin: 8px; }
        .squiggle { border-radius: 50% 10%; }
        .solid { background-color: currentColor; }
        .striped { background: repeating-linear-gradient(45deg, transparent, transparent 2px, currentColor 2px, currentColor 4px); }
    </style>
</head>
<body>
    <h2 id="turn">Waiting...</h2>
    <div id="scores">P1: 0 | P2: 0</div>
    <div id="board"></div>

    <script>
        const socket = io();
        const board = document.getElementById('board');
        let myTurn = false;

        socket.on('init', (state) => {
            board.innerHTML = '';
            state.deck.forEach((card, i) => {
                const div = document.createElement('div');
                div.className = 'card';
                div.dataset.index = i;
                div.innerHTML = `<div class="card-inner"><div class="back"></div><div class="front" style="color:${card.color}"></div></div>`;
                const front = div.querySelector('.front');
                for(let n=0; n<card.number; n++) {
                    const s = document.createElement('div');
                    s.className = `symbol ${card.shape} ${card.filling}`;
                    front.appendChild(s);
                }
                div.onclick = () => socket.emit('cardClicked', i);
                board.appendChild(div);
            });
            updateUI(state);
        });

        socket.on('syncFlip', (indices) => {
            document.querySelectorAll('.card').forEach((c, i) => {
                indices.includes(i) ? c.classList.add('flipped') : (c.dataset.matched !== 'true' && c.classList.remove('flipped'));
            });
        });

        socket.on('matchFound', (data) => {
            data.matched.forEach(i => {
                const el = document.querySelector(`[data-index="${i}"]`);
                el.classList.add('matched');
                el.dataset.matched = 'true';
            });
            document.getElementById('scores').innerText = `P1: ${data.scores.p1} | P2: ${data.scores.p2}`;
        });

        socket.on('turnEnd', (data) => {
            document.querySelectorAll('.card:not(.matched)').forEach(c => c.classList.remove('flipped'));
            document.getElementById('turn').innerText = `${data.currentPlayer.toUpperCase()}'s Turn`;
        });

        function updateUI(state) {
            document.getElementById('turn').innerText = `${state.currentPlayer.toUpperCase()}'s Turn`;
        }
    </script>
</body>
</html>
